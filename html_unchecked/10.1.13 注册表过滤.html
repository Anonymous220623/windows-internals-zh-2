<h3 class="bt3" id="sigil_toc_id_119">10.1.13　注册表过滤</h3>
<p class="zw">Windows内核中的配置管理器实现了一种强大的注册表过滤模型，借此可使用诸如进程监视器等工具监视注册表活动。当驱动程序使用回调机制时，会向配置管理器注册一个回调函数。配置管理器会在执行注册表系统服务之前和之后执行驱动程序的回调函数，这样驱动程序就可以对注册表的访问获得完整的可视性和控制力。反病毒产品也会使用这种回调机制在注册表数据中扫描病毒，或防止对注册表进行未经授权的更改。</p>
<p class="zw">注册表回调也与海拔高度（altitude）的概念有关。不同供应商可以借助海拔高度这种方式在注册表过滤栈上注册一个“高度”，这样系统就可以确定性的正确顺序调用不同的回调例程。这样即可避免一些情况，例如反病毒产品可能会在加密产品运行自己的回调以解密被加密的键之前，试图扫描这些加密的键。为了避免这种情况，在Windows注册表回调模型的帮助下，这两类工具都会被分配一个与它们所进行的过滤类型（本例中是加密和病毒扫描）相对应的基准海拔高度。此外，创建此类工具的公司必须向微软注册，这样才能保证自己集团公司内部不会因为功能类似或相互竞争的产品产生冲突。</p>
<p class="zw">该过滤模型还可以完全接管对注册表操作的处理（借此可绕过配置管理器，并防止配置管理器处理任何请求），或将一个操作重定向为另一个操作（例如WoW64的注册表重定向）。此外，借此还可以修改注册表操作的输出参数以及返回的值。</p>
<p class="zw">最后，驱动程序可出于自己的目的分配并标记每个键或每个操作中由驱动程序定义的信息。驱动程序可在执行创建或打开操作期间创建并分配这种上下文数据，配置管理器会记住这些数据，并在针对键执行的后续操作中返回这些数据。</p>

<p class="epubit-contents-id" style="display: none">{"index":12,"parentId":"5a53b69b-1f5b-45b1-989a-6fe8c9cf2a82","id":"6b175fdd-0419-4b23-b6b4-03777f886f92"}</p>