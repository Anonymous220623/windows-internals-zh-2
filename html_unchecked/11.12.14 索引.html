<h3 class="bt3" id="sigil_toc_id_265">11.12.14　索引</h3>
<p class="zw">在NTFS中，文件目录只是文件名的一个索引，也就是说，文件名（连同其文件记录号）的集合会被组织为B树。要创建目录，NTFS会对目录中文件的文件名属性创建索引。卷根目录的MFT记录如图11-50所示。</p>
<p class="zw">从概念上来说，目录的MFT项在其索引根属性中包含一个该目录中文件排序后的列表。不过对于较大的目录，文件名实际上存储在固定4&nbsp;KB大小的索引缓冲区（索引分配属性的非常驻值）中，借此包含并整理文件名。索引缓冲区实现了一种B树数据结构，可最大限度减少寻找特定文件所需的磁盘访问次数，尤其是在大型目录中。索引根属性包含B树的第一层（根子目录），并指向包含下一层（也许是更多子目录或文件）的索引缓冲区。</p>
<p class="图"></p>
<img src="../res/pubcloud/5B0A982E/ushu/UBda647ada3435/online/FBOLda82494f5f9f/Images/tx2411.png" style="width: 100%" />
<p class="图题">图11-50　卷根目录的文件名索引</p>
<p class="zw">图11-50只展示了索引根属性和索引缓冲区中的文件名（如file6），其实索引中的每个项也包含描述该文件的MFT中的记录号以及文件的时间戳和文件大小信息。NTFS会从文件的MFT记录复制时间戳和文件大小信息。这种被FAT和NTFS使用的技术需要将更新后的信息写入两个地方。即便如此，这也可以大幅加快目录浏览速度，因为文件系统无须打开目录中的每个文件，即可显示每个文件的时间戳和大小信息。</p>
<p class="zw">索引分配属性会将索引缓冲区运行的VCN映射到LCN，而该LCN指向索引缓冲区在磁盘上的位置，位图属性则可用于跟踪索引缓冲区中哪些VCN已被使用，哪些空闲。图11-50展示了每个VCN（即每个簇）的一个文件项，但文件名项实际上已经打包到每个簇中。每个4&nbsp;KB的索引缓冲区通常会包含大约20到30个文件名项（取决于目录中文件名的长度）。</p>
<p class="zw">B树数据结构是一种平衡树，是用于组织磁盘中所存储数据的最佳选择，因为可以最大限度减少寻找项所需的磁盘访问次数。在MFT中，目录的索引根属性包含多个文件名，这些名称可作为&nbsp;B&nbsp;树的第二级索引。索引根属性中的每个文件名都有一个与之相关的可选指针以指向索引缓冲区。该索引缓冲区会指向词典分类顺序（Lexicographic）值小于自己的文件名。例如在图11-50中，file4是B树中的第一级项，它指向词典分类顺序上所包含文件名小于自己的索引缓冲区，即文件名file0、file1和file3。请注意，本例中使用的文件名file1、file3等并非字面意义上的文件名，而是为了展现文件的相对位置，按照显示过程中的词典分类顺序排序的名称。</p>
<p class="zw">将文件名存储在B树中有多个好处：目录查找速度更快，因为文件名已经以排序后的方式存储好了；当高层软件枚举目录中的文件时，NTFS将返回排序后的名称；由于B树更倾向于在宽度而非深度方向上增长，因此NTFS的查找速度并不会因为目录增长而下降。</p>
<p class="zw">NTFS还提供了对文件名之外其他索引数据的常规支持，而一些NTFS功能（如对象ID、配额跟踪以及整合的安全性）也需要使用索引来管理内部数据。</p>
<p class="zw">B树索引是NTFS的一种通用能力，可用于整理安全描述符、安全ID、对象ID、磁盘配额记录以及重分析点。目录也叫文件名索引，其他类型的索引则可称为视图索引。</p>

<p class="epubit-contents-id" style="display: none">{"index":13,"parentId":"65b5fd03-8e4f-4d2b-beba-4e7c140dd099","id":"296ade3d-9f82-4380-b222-5bb6a8de3ed9"}</p>