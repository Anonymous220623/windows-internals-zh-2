<h3 class="bt3" id="sigil_toc_id_267">11.12.16　配额跟踪</h3>
<p class="zw">NTFS将配额信息存储在\$Extend\$Quota元数据文件中，其中包含命名索引根属性$O和$Q。图11-52展示了这些索引的组织方式。就像NTFS会为每个安全描述符分配一个唯一内部安全ID一样，NTFS也会为每个用户分配一个唯一用户ID。当管理员为用户定义配额时，NTFS会分配一个与该用户的SID对应的用户ID。在$O索引中，NTFS会创建一个项，借此将SID映射至用户ID，并使用SID对该索引排序；在$Q索引中，NTFS会创建配额控制项。配额控制项包含用户的配额限制值，以及用户在卷上已使用的磁盘空间总量信息。</p>
<p class="zw">当应用程序创建文件或目录时，NTFS会获取应用程序用户的SID并在$O索引中查找相关的用户ID。NTFS会将用户ID记录到新文件或目录的$STANDARD_INFORMATION属性中，借此将分配给该文件或目录的所有磁盘空间计入该用户的配额中。随后NTFS会在$Q索引中查找配额项，并确定新分配是否会导致用户超出自己的警报或限制阈值。如果新分配会导致用户超出阈值，则NTFS会执行相应的措施，如在系统事件日志中记录事件，或不允许用户创建文件或目录。随着文件或目录大小的更改，NTFS&nbsp;会更新$STANDARD_ INFORMATION属性中存储的、与用户ID相关的配额控制项。NTFS会使用NTFS通用B树索引将用户ID与账户SID高效关联在一起，并借此通过用户ID快速找出用户的配额控制信息。</p>
<p class="图"></p>
<img src="../res/pubcloud/5B0A982E/ushu/UBda647ada3435/online/FBOLda82494f5f9f/Images/tx24261.png" style="width: 100%" />
<p class="图题">图11-52　$Quota索引</p>

<p class="epubit-contents-id" style="display: none">{"index":15,"parentId":"65b5fd03-8e4f-4d2b-beba-4e7c140dd099","id":"0b88a7bd-c59e-43dd-b6ec-92fac3787494"}</p>