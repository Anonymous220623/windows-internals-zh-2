<h3 class="bt3" id="sigil_toc_id_268">11.12.17　综合安全性</h3>
<p class="zw">NTFS始终支持安全性，借此管理员可以指定哪个用户可以或不可以访问特定的文件和目录。为了优化安全描述符的磁盘利用率，NTFS会使用一个名为$Secure的中心元数据文件，从而只存储每个安全描述符的一个实例。</p>
<p class="zw">如图11-53所示，$Secure文件包含两个索引属性：$SDH（安全描述符哈希）和$SII（安全ID索引），此外还包含一个名为$SDS（安全描述符流）的数据流属性。NTFS为卷上每个唯一安全描述符分配一个内部NTFS安全ID（和Windows SID不是一回事，Windows SID用于标识唯一的计算机和用户账户），并用一种简单的哈希算法为安全描述符创建哈希。哈希可以看成描述符的一种潜在的、非唯一的速记表达。$SDH索引项将安全描述符哈希映射至安全描述符在$SDS数据属性中的存储位置，$SII索引项将NTFS安全ID映射至安全描述符在$SDS数据属性中的位置。</p>
<p class="图"></p>
<img src="../res/pubcloud/5B0A982E/ushu/UBda647ada3435/online/FBOLda82494f5f9f/Images/1153.png" style="width: 100%" />
<p class="图题">图11-53　$Secure索引</p>
<p class="zw">当将安全描述符应用给文件或目录时，NTFS会获取描述符的哈希，并在$SDH索引中查找匹配项。NTFS会根据相应的安全描述符的哈希对$SDH索引项排序，并将项存储在B树中。如果在$SDH索引中找到匹配的描述符，则NTFS会通过该项的偏移量值找出安全描述符项的偏移量，并从$SDS属性读取安全描述符。如果哈希匹配但安全描述符不匹配，则NTFS会在$SDH索引中查找另一个匹配项。在NTFS找到严格的匹配项后，想要应用安全描述符的文件或目录即可直接引用$SDS特性中的现有安全描述符。NTFS在进行引用时，会从$SDH项读取NTFS安全标识符，将其存储在文件或目录的$STANDARD_ INFORMATION属性中。所有文件和目录都具备NTFS的这个属性，其中存储了有关文件的基本信息，如属性、时间戳信息、安全描述符。</p>
<p class="zw">如果NTFS在$SDH索引中没有找到与想要应用的安全描述符相符的项，这意味着该安全描述符在这个卷上是唯一的，NTFS会为描述符分配一个新的内部安全ID。NTFS内部安全ID是一种32位值，SID通常会比它大几倍，因此，用NTFS的安全ID代替SID还可节约$STANDARD_INFORMATION属性占用的空间。随后，NTFS会将该安全描述符添加到$SDS数据属性的尾部，并在$SDH和$SII索引中添加表示该描述符在$SDS数据中偏移量的项。</p>
<p class="zw">当应用程序试图打开文件或目录时，NTFS会使用$SII索引查找文件或目录的安全描述符。NTFS会从MFT项的$STANDARD_INFORMATION属性中读取文件或目录的内部安全ID，随后使用$Secure文件的$SII索引在$SDS数据属性中定位该ID。对$SDS属性的偏移量使得NTFS可以顺利读取安全描述符并完成安全检查。NTFS会将最近访问过的32个安全描述符及其$SII索引项存储在缓存中，这样就只需要在$SII未缓存时才会访问$Secure文件。</p>
<p class="zw">NTFS不会删除$Secure文件中的项，哪怕卷中的文件和目录都不再引用。保留这些项并不会导致磁盘空间的浪费，因为大部分卷，哪怕已经使用了很长时间，也只会产生很少量的唯一安全描述符。</p>
<p class="zw">NTFS对通用B树索引的使用使得具备相同安全设置的文件和目录最终可以共享安全描述符。$SII索引可以帮助NTFS在$Secure文件中快速查找安全描述符并执行安全检查，$SDH索引可以帮助NTFS快速确定应用给文件或目录的安全描述符是否已经存储在$Secure文件中并且可以被共享。</p>

<p class="epubit-contents-id" style="display: none">{"index":16,"parentId":"65b5fd03-8e4f-4d2b-beba-4e7c140dd099","id":"a7d7dc99-6e36-4606-a687-21e709d5df29"}</p>