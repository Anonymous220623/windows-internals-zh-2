<h3 class="bt3" id="sigil_toc_id_253">11.12.2　簇</h3>
<p class="zw">当用户使用format命令或磁盘管理控制台MMC插件格式化卷时，NTFS卷上的簇（cluster）大小（也叫簇因子，cluster factor）就确定了。默认簇因子随着卷的不同大小而变化，但它始终是物理扇区的整数倍，并且总是2的幂（1个扇区、2个扇区、4个扇区、8个扇区，以此类推）。簇因子以簇中的字节数来表示，例如512&nbsp;B、1&nbsp;KB、2&nbsp;KB等。</p>
<p class="zw">在内部，NTFS只引用簇（不过NTFS会塑造底层卷I/O操作，使簇始终与扇区对齐，并且长度是扇区大小的倍数）。NTFS使用簇作为分配单元，以维持相对于物理扇区大小的独立性。这种独立性使得NTFS可以通过使用更大的簇因子更高效地支持大容量磁盘，或者支持扇区大小超过512&nbsp;B的新磁盘。在更大的卷上，使用更大的簇因子有助于降低碎片化程度并加速分配，但代价是会浪费一定的磁盘空间（如果簇大小为64&nbsp;KB，而文件大小仅为16&nbsp;KB，那么将有48&nbsp;KB被浪费）。命令行下的format命令和磁盘管理控制台“操作”菜单中“所有任务”选项下的格式化菜单项都会根据卷大小选择默认的簇因子，但我们可以更改这个大小。</p>
<p class="zw">NTFS通过逻辑簇编号（Logical Cluster Number，LCN）引用磁盘上的物理位置。LCN可以理解为从卷首到卷尾的所有簇的编号。为了将LCN转换为物理磁盘地址，当磁盘驱动程序接口进行查询时，NTFS会将LCN与簇因子相乘，得到卷上的物理字节偏移量。NTFS会通过虚拟簇编号（Virtual Cluster Number，VCN）的方式引用文件中的数据。VCN是指对属于特定文件的所有簇进行的编号，从0到m。不过VCN在物理上未必是物理连续的，它们可以映射到卷上任意数量的LCN。</p>

<p class="epubit-contents-id" style="display: none">{"index":1,"parentId":"65b5fd03-8e4f-4d2b-beba-4e7c140dd099","id":"f3178a3b-baf8-4aed-aaf6-bb7a37121133"}</p>