<h3 class="bt3" id="sigil_toc_id_277">11.13.1　设计</h3>
<p class="zw">NTFS实现了可恢复文件系统的设计。可恢复文件系统通过使用最初为事务处理开发的日志记录技术（也叫Journal）保证了卷的一致性。如果操作系统崩溃，可恢复文件系统将执行恢复过程以访问存储在日志文件中的信息，进而恢复一致性。由于文件系统已将磁盘写入记录到日志中，无论多大的卷，恢复过程都可以在几秒内完成（不像FAT文件系统，恢复时间与卷的大小密切相关）。可恢复文件系统的恢复过程是精确的，可保证卷被恢复至一致的状态。</p>
<p class="zw">可恢复文件系统所实现的安全性需要付出一定的代价。每个会改变卷结构的事务，都需要为该事务的每个子操作将一条记录写入日志文件中。这种日志记录所造成的开销可通过文件系统的日志批处理操作得以改善，即通过一个I/O操作将多条记录写入日志文件。此外，可恢复文件系统还可以使用惰性写入文件系统这种优化措施，甚至可以延长两次缓存刷新操作的间隔时间，因为如果在将缓存的变化刷新到磁盘之前系统就已崩溃，文件系统元数据依然可以恢复。这种缓存性能提升机制与惰性写入文件系统相互配合，可有效弥补甚至完全抵消可恢复文件系统日志记录活动所产生的性能开销。</p>
<p class="zw">无论是慎重写入操作还是惰性写入文件系统，都无法保证为用户文件数据提供保护。如果系统在应用程序写入文件的过程中崩溃，文件可能丢失或损坏。更糟的是，崩溃可能导致惰性写入文件系统出错，进而破坏原有文件，甚至让整个卷处于不可访问的状态。</p>
<p class="zw">为实现比传统文件系统更高的可恢复性，NTFS可恢复文件系统实现了多种策略。首先，NTFS可恢复性保证了卷结构不会损坏，因此系统出现故障后，所有文件依然是可以访问的。其次，尽管NTFS无法保证在系统崩溃后依然保护用户数据（一些改动可能会从缓存中丢失），但应用程序可以利用NTFS的直写和缓存刷新能力保证以适当的时间间隔将文件改动记录到磁盘上。</p>
<p class="zw">缓存直写（强制将写操作立即记录到磁盘上）和缓存刷新（强制将缓存内容写入磁盘）都是很高效的操作。NTFS无须执行额外的磁盘I/O即可将改动刷新到多种不同的文件系统数据结构，因为对数据结构的改动均已通过一个写操作记录至日志文件，如果出现故障导致缓存内容丢失，则可从日志中恢复文件系统的改动。此外，与FAT文件系统不同，即便系统随后遇到故障，NTFS也能保证用户数据在直写操作或缓存刷新后处于一致、立即可用的状态。</p>

<p class="epubit-contents-id" style="display: none">{"index":0,"parentId":"244f39ce-6f59-4168-9f84-d031b04d0916","id":"8c05c520-299c-4410-b8e9-994b3ec711d7"}</p>