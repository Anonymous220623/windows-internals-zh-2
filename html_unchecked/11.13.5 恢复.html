<h3 class="bt3" id="sigil_toc_id_281">11.13.5　恢复</h3>
<p class="zw">系统启动后，当程序首次访问NTFS卷时，NTFS会自动执行磁盘恢复（如果无须恢复，则该过程将被忽略）。恢复取决于NTFS在内存中维护的两个表：一个事务表，其作用类似TxF维护的表；以及一个脏页表，其中记录了缓存中的哪些页包含对文件系统结构的改动但尚未写入磁盘。恢复过程中必须将这些数据刷新到磁盘。</p>
<p class="zw">NTFS每隔5秒向日志文件中写入一次检查点记录。在此之前，它会调用LFS将事务表和脏页表的当前副本存储到日志文件。随后NTFS会在检查点记录中包含日志记录的LSN，该日志记录包含了复制的表。当系统故障后开始恢复时，NTFS会调用LFS来定位包含最新检查点记录和事务以及脏页表最新副本的日志记录，随后将这些表复制到内存中。</p>
<p class="zw">日志文件通常包含最后一个检查点记录后产生的后续更新记录，这些更新记录代表最后一次写入检查点记录之后对卷进行的改动。NTFS必须更新事务和脏页表，将新的操作包含在内。更新这些表后，NTFS会使用表和日志文件的内容来更新卷本身。</p>
<p class="zw">为了执行卷恢复，NTFS会将日志文件扫描三次。为了最大限度地减少磁盘I/O，还会在第一次扫描时将文件内容载入内存。每次扫描都是为了实现不同的目的。</p>
<p class="zw">1）分析。</p>
<p class="zw">2）重做事务。</p>
<p class="zw">3）撤销事务。</p>

<p class="epubit-contents-id" style="display: none">{"index":4,"parentId":"244f39ce-6f59-4168-9f84-d031b04d0916","id":"2c9f3a0f-0f7f-498d-add7-e451c52f8d75"}</p>