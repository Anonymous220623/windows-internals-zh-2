<h3 class="bt3" id="sigil_toc_id_320">11.17.5　叠瓦式磁记录卷</h3>
<p class="zw">截至撰写这部分内容，传统机械硬盘所面临的最大问题之一在于记录方式本身所面临的固有物理局限。为了增大磁盘容量，硬盘盘片的密度必须不断增大，然而，为了能读/写越来越小的信息单元，机械硬盘磁头的物理尺寸也必须越来越小。这会造成比特反转（Bit flip）<sup>[4]</sup>的能量壁垒日渐降低，这意味着环境温度所蕴含的能量可能在无意中造成比特反转，进而危及数据完整性。虽然固态硬盘（SSD）在面向消费者的系统中基本已经普及，但大型存储服务器依然在使用传统的机械硬盘，只有这类硬盘可以用更低的成本来提供更大的容量。为了解决机械硬盘面临的这种问题，业界提出了多种解决方案，其中最有效的一种方案名为叠瓦式磁记录（Shingled Magnetic Recording，SMR），如图11-91所示。传统的PMR（Perpendicular Magnetic Recording，垂直磁记录）技术使用了平行轨道的布局，而SMR磁盘用于读取数据的磁头远小于用于写入数据的磁头。更大的写入磁头意味着它可以更有效地磁化介质（进而写入数据），而不会对可读性或稳定性产生影响。</p>
<p class="footnote">[4]比特反转是指计算机系统（硬盘、内存、CPU……）中所存储的二进制数据，因为软硬件故障或外部干扰导致其状态在不经意间发生变化的情况，例如，原本的“0”被反转为“1”，原本的“1”被反转为“0”。在某些情况下，这种问题可能导致数据错误、程序崩溃，甚至系统崩溃。——译者注</p>
<p class="图"></p>
<img src="../res/pubcloud/5B0A982E/ushu/UBda647ada3435/online/FBOLda82494f5f9f/Images/tx3607.png" style="width: 100%" />
<p class="图题">图11-91　在SMR磁盘中，写入磁道远大于读取磁道</p>
<p class="zw">这种新配置造成了一些逻辑上的问题。如果不替换部分连续磁道上的数据，那么几乎不可能向硬盘上的磁道写入数据。为了解决这个问题，SMR磁盘将硬盘分为多个区域（zone），技术上每个区域可称为一个带（band）。区域主要分为两种类型。</p>
<p class="zwd"><span style="color: #0092dd">●</span> 传统（或快速）区域，其工作方式与传统PMR磁盘一样，可进行随机写入。</p>
<p class="zwd"><span style="color: #0092dd">●</span> 写指针区域是有自己的“写指针”并且需要严格进行顺序写入的带（并不一定如此，支持主机感知的SMR磁盘也支持写入首选区域这样的概念，借此依然可支持随机写入。不过ReFS并未使用此类区域）。</p>
<p class="zw">SMR磁盘中的每个带通常为256&nbsp;MB，可以作为一个基本I/O单位使用。这意味着系统可以在不干扰其他带的情况下向一个带写入。SMR磁盘共分为三种类型。</p>
<p class="zwd"><span style="color: #0092dd">●</span> <strong style="color:#0092dd">驱动器管理（drive-managed）</strong>：在主机看来，这种驱动器与非叠瓦式驱动器没有任何区别。主机无须遵循任何特殊协议，因为所有数据处理工作和磁盘区域的存在以及顺序写入的限制都是由设备固件负责管理的。此类SMR磁盘兼容性很好，但也存在一些局限，即用于将随机写入转换为顺序写入的磁盘缓存容量是有限的，带的清理是一种复杂操作，并且顺序写入检测也很重要。这些局限都会对性能产生不利影响。</p>
<p class="zwd"><span style="color: #0092dd">●</span> <strong style="color:#0092dd">主机管理（host-managed）</strong>：此类设备要求主机严格遵循特定的I/O规则。主机需要按顺序写入才能不破坏现有数据。如果有命令违反了这一假设，那么硬盘将会拒绝执行这样的命令。主机管理的硬盘只支持顺序写入区域和传统区域，传统区域可以位于任何介质上，包括非SMR硬盘、驱动器管理的SMR以及闪存。</p>
<p class="zwd"><span style="color: #0092dd">●</span> <strong style="color:#0092dd">主机感知（host-aware）</strong>：驱动器管理和主机管理两种技术的结合体，这种硬盘可以管理存储设备“叠瓦式”的本质特征，并能执行主机发出的任何命令，而无论该命令是否连续。然而，主机可以知道这种硬盘是叠瓦式的，因此可以查询硬盘以获得SMR区域信息。这样，主机就可以围绕叠瓦式的本质特征优化自己的写入操作，同时依然让硬盘具备足够的灵活性和向后兼容性。主机感知的硬盘支持顺序写入首选区域的概念。</p>
<p class="zw">截至撰写这部分内容，ReFS是唯一能原生支持主机管理SMR磁盘的文件系统。ReFS为支持这类硬盘所使用的策略可实现非常大的容量（20&nbsp;TB甚至更高），并且与分层卷所用的策略类似，通常可通过存储空间创建（有关存储空间的详细信息请参阅最后一节）。</p>

<p class="epubit-contents-id" style="display: none">{"index":4,"parentId":"bfef1a76-a058-4e31-96a2-fa59897a014e","id":"591726fa-c4d5-46c7-855d-9b0fed63a912"}</p>