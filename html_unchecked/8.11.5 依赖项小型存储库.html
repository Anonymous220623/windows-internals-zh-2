<h3 class="bt3" id="sigil_toc_id_63">8.11.5　依赖项小型存储库</h3>
<p class="zw">打开SQLite数据库并使用SQL查询提取所需信息的操作开销可能很高。此外，当前的架构还需要通过RPC完成一些进程间的通信。这两个局限有时会因限制性太大而难以满足。用户通过命令行控制台启动新应用程序（例如通过执行别名来启动）就是一个典型的例子。每当系统产生一个进程时都检查状态存储库，这会造成巨大的性能问题。为了解决这些问题，应用程序模型引入了依赖项小型存储库（Dependency Mini Repository，DMR），这是一种较小规模的存储，其中只包含现代应用程序的信息。</p>
<p class="zw">与状态存储库不同，依赖项小型存储库不使用任何数据库，而是通过一种微软专有的二进制格式来存储数据，这些数据可被任何安全上下文中的文件系统所访问（甚至内核模式驱动程序也可以解析DMR数据）。其中System Metadata（系统元数据）目录由状态存储库根路径中名为Packages的文件夹所表示，里面包含一个子文件夹列表，每个子文件夹对应一个已安装的程序包。依赖项小型存储库由一个.pckgdep文件所代表，其名称与用户的SID相同。在为用户注册程序包时，部署服务会创建DMR文件（更多细节请参阅下文“程序包注册”一节）。</p>
<p class="zw">当系统为属于打包应用程序的程序创建进程时，将大量使用依赖项小型存储库（位于AppX Pre-CreateProcess扩展中）。因此，依赖项小型存储库完全实现于Win32的kernelbase.dll中（但一些存根函数位于kernel.appcore.dll中）。当创建进程并打开DMR文件时，会读取并解析其内容，并将结果映射至父进程的内存中。子进程创建完成后，加载器代码甚至会在子进程中映射。DMR文件包含下列多种信息。</p>
<p class="zwd"><span style="color: #0092dd">●</span> 程序包信息，如ID、完整名称、完整路径、发行商。</p>
<p class="zwd"><span style="color: #0092dd">●</span> 应用程序信息：应用程序用户模型ID和相关ID、描述、显示名称以及徽标图像。</p>
<p class="zwd"><span style="color: #0092dd">●</span> 安全上下文：AppContainer SID和能力。</p>
<p class="zwd"><span style="color: #0092dd">●</span> 目标平台和程序包依赖性图（当一个程序包依赖一个或多个其他程序包时使用）。</p>
<p class="zw">按照设计，未来版本Windows中的DMR文件还可以在需要时包含更多信息。在使用依赖项小型存储库的情况下，进程的创建速度将足够快，并且不需要查询状态存储库。需要注意的是，DMR文件会在进程创建完毕后关闭。因此我们甚至可以在现代应用程序执行过程中重写入.pckgdep文件，向其中添加可选程序包。借此，用户可在无须重启动的前提下为现代应用程序添加功能。程序包小型存储库的一小部分内容（主要是程序包的完整名称和路径）甚至可以作为缓存，复制到不同的注册表键以便进一步提高访问速度。这种缓存通常会用于一些常用操作（如检查某个程序包是否存在）。</p>

<p class="epubit-contents-id" style="display: none">{"index":4,"parentId":"9334f317-a4b1-4935-821c-b084138eb566","id":"8b32ba3e-f3dc-4b74-ac24-a18ebe780106"}</p>