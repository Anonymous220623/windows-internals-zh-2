<h3 class="bt3" id="sigil_toc_id_40">8.8.4　视图、区域和节</h3>
<p class="zw">服务器和客户端可以选择更高效的数据传递机制，而非在各自进程之间发送消息缓冲区，这种机制也是Windows内存管理器的核心：节对象（详见卷1第5章）。借此内存将能以共享的方式分配，为客户端和服务器提供一致、平等的内存视图。这种情况下可以传输尽可能多的数据，数据只需要复制到一个地址范围，便会立即在另一个范围内可用。然而共享内存通信（例如LPC原本提供的通信机制）也有一些不足之处，尤其是对安全性产生的影响。例如，因为客户端和服务器必须访问共享的内存，非特权客户端可以借此破坏服务器的共享内存，甚至借助潜在漏洞构建可执行的载荷。此外，因为客户端知道服务器数据的位置，因此可以使用这些信息绕过ASLR保护（详见卷1第5章）。</p>
<p class="zw">ALPC在节对象基础上提供了自己的安全机制。在ALPC中，必须使用相应的NtAlpcCreatePortSection API创建特定的ALPC节对象，借此产生对端口的正确引用，并实现原子性的节垃圾回收（也可通过手动API进行删除）。随着ALPC节对象的所有者开始使用该节，所分配的块（Chunk）将会创建为ALPC区域（Region），它代表了该节中已使用的地址范围，并为消息提供了一个额外的引用。最后，在共享内存范围内，客户端可以获得该内存的视图（View），这代表了自己地址空间内部的本地映射。</p>
<p class="zw">区域还支持多种安全选项。首先，区域可以通过安全模式或不安全模式进行映射。在安全模式下，区域只能包含两个视图（映射），当服务器希望以私密的方式与客户端进程分享数据时，通常会使用该模式。此外，在特定端口的上下文中，只能为特定的共享内存范围打开一个区域。最后，区域可以标记为写访问保护，这样将只有一个进程上下文（服务器）可以对视图进行写入操作（使用MmSecureVirtualMemoryAgainstWrites），而其他客户端只能进行只读访问。这些设置缓解了很多以共享内存为目标的特权提升攻击，也让ALPC比传统IPC机制更具弹性。</p>

<p class="epubit-contents-id" style="display: none">{"index":3,"parentId":"e3feacd9-ccbb-4c83-b36b-bb1c5293963c","id":"3b08a75b-1aec-4ff2-b75a-a0d44e8196f1"}</p>