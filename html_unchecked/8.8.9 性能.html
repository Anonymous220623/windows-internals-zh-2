<h3 class="bt3" id="sigil_toc_id_45">8.8.9　性能</h3>
<p class="zw">ALPC会通过多种策略改善性能，主要用到了ALPC对完成列表的支持，这一点在上文已经简单介绍过。在内核层面上，完成列表在本质上是一种用户内存描述符列表（Memory Descriptor List，MDL），它会被探测并锁定，然后映射至某个地址（有关MDL的详情请参阅卷1第5章）。因为与负责跟踪物理页面的MDL相关联，当客户端向服务器发送消息时，载荷复制操作可以直接发生在物理层面，而不需要像其他IPC机制的常见做法那样，要求内核对消息进行双重缓冲。</p>
<p class="zw">完成列表本身是作为一个已完成项的64位队列来实现的，用户模式和内核模式的使用者都可以使用互锁的“比较-交换”操作向队列中插入或移除项。此外，为了简化分配，一旦一个MDL成功进行了初始化，将使用一个位图来识别可用的内存区域，这些区域可用来容纳依然在排队的新消息。该位图的算法还会使用处理器上的本地锁指令来提供物理内存区域的原子性分配和撤销分配操作，这些操作可被完成列表使用。完成列表则可通过NtAlpcSetInformationPort设置。</p>
<p class="zw">最后一个值得介绍的优化措施是：内核不会在发送消息的时候复制数据，而是会设置延迟复制载荷，借此可在无须进行任何复制的情况下只捕获需要的信息。只有当接收方请求消息时才会真正复制消息数据。很明显，如果使用了共享的内存，这种方法将无法提供任何优势，但在异步的内核缓冲区消息传递机制中，可以通过这种方法优化取消场景和高流量场景。</p>

<p class="epubit-contents-id" style="display: none">{"index":8,"parentId":"e3feacd9-ccbb-4c83-b36b-bb1c5293963c","id":"f929174e-b13e-46d1-98f2-95f7209439ae"}</p>